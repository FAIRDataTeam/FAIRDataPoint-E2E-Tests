services:
  fdp:
    # entire string `{SERVER_IMAGE}` is replaced in scripts/init.sh 
    image: {SERVER_IMAGE}
    restart: always
    ports:
      # <host port>:<container port>
      - 3000:80
    volumes:
      # bind mount
      - ./application.yml:/fdp/application.yml:ro
    healthcheck:
      test: curl --no-progress-meter --fail http://fdp:80 || exit 1
    depends_on:
      db:
        condition: service_healthy
      
  fdp-client:
    image: {CLIENT_IMAGE}
    ports:
      - 80:80
      - 3333:3333
    environment:
      # fdp service is defined above
      - FDP_HOST=fdp
    depends_on:
      fdp:
        condition: service_healthy

  db:
    # content added by init.sh script (database type depends on fdp version)
